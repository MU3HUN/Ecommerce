(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-39c21ad2"],{"04d1":function(e,t,a){"use strict";var r=a("342f"),n=r.match(/firefox\/(\d+)/i);e.exports=!!n&&+n[1]},"0a30":function(e,t,a){"use strict";a("8f7f")},4242:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-form",{directives:[{name:"show",rawName:"v-show",value:e.showSearch,expression:"showSearch"}],ref:"queryForm",attrs:{model:e.queryParams,size:"small",inline:!0,"label-width":"68px"}},[a("el-form-item",{attrs:{label:"姓名",prop:"userName"}},[a("el-select",{attrs:{placeholder:"请选择姓名",clearable:""},on:{change:e.handleQuery},model:{value:e.queryParams.userName,callback:function(t){e.$set(e.queryParams,"userName",t)},expression:"queryParams.userName"}},e._l(e.userNames,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"核销状态",prop:"status"}},[a("el-select",{attrs:{placeholder:"选择状态",clearable:""},on:{change:e.handleQuery},model:{value:e.queryParams.status,callback:function(t){e.$set(e.queryParams,"status",t)},expression:"queryParams.status"}},[a("el-option",{attrs:{label:"已核销",value:"已核销"}}),a("el-option",{attrs:{label:"未核销",value:"未核销"}})],1)],1),a("el-form-item",{attrs:{label:"核销码",prop:"qrNumber"}},[a("el-input",{attrs:{placeholder:"输入核销码",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.qrNumber,callback:function(t){e.$set(e.queryParams,"qrNumber",t)},expression:"queryParams.qrNumber"}})],1),a("el-form-item",{attrs:{label:"生成时间",prop:"params.startTime"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择开始时间","value-format":"yyyy-MM-dd HH:mm:ss"},on:{change:e.handleQuery},model:{value:e.queryParams.params.startTime,callback:function(t){e.$set(e.queryParams.params,"startTime",t)},expression:"queryParams.params.startTime"}})],1),a("el-form-item",{attrs:{label:"至",prop:"params.endTime"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择结束时间","value-format":"yyyy-MM-dd HH:mm:ss"},on:{change:e.handleQuery},model:{value:e.queryParams.params.endTime,callback:function(t){e.$set(e.queryParams.params,"endTime",t)},expression:"queryParams.params.endTime"}})],1),a("el-form-item",{attrs:{label:"核销时间",prop:"params.redeemStartTime"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择核销开始时间","value-format":"yyyy-MM-dd HH:mm:ss"},on:{change:e.handleQuery},model:{value:e.queryParams.params.redeemStartTime,callback:function(t){e.$set(e.queryParams.params,"redeemStartTime",t)},expression:"queryParams.params.redeemStartTime"}})],1),a("el-form-item",{attrs:{label:"至",prop:"params.redeemEndTime"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择核销结束时间","value-format":"yyyy-MM-dd HH:mm:ss"},on:{change:e.handleQuery},model:{value:e.queryParams.params.redeemEndTime,callback:function(t){e.$set(e.queryParams.params,"redeemEndTime",t)},expression:"queryParams.params.redeemEndTime"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("搜索")]),a("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.resetQuery}},[e._v("重置")])],1)],1),a("el-row",{staticClass:"mb8",attrs:{gutter:10}},[a("el-col",{attrs:{span:1.5}},[a("el-button",{attrs:{type:"primary",plain:"",icon:"el-icon-scan",size:"mini"},on:{click:e.openScanDialog}},[e._v("扫码核销")])],1),a("el-col",{attrs:{span:1.5}},[a("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["code:code:remove"],expression:"['code:code:remove']"}],attrs:{type:"danger",plain:"",icon:"el-icon-delete",size:"mini",disabled:e.multiple},on:{click:e.handleDelete}},[e._v("删除")])],1),a("el-col",{attrs:{span:1.5}},[a("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["code:code:export"],expression:"['code:code:export']"}],attrs:{type:"warning",plain:"",icon:"el-icon-download",size:"mini"},on:{click:e.handleExport}},[e._v("导出")])],1),a("right-toolbar",{attrs:{showSearch:e.showSearch},on:{"update:showSearch":function(t){e.showSearch=t},"update:show-search":function(t){e.showSearch=t},queryTable:e.getList}})],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.codeList},on:{"selection-change":e.handleSelectionChange,"sort-change":e.handleSort}},[a("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),a("el-table-column",{attrs:{label:"姓名",align:"center",prop:"userName"}}),a("el-table-column",{attrs:{label:"二维码编号",align:"center",prop:"qrNumber"}}),a("el-table-column",{attrs:{label:"核销状态",align:"center",prop:"status"}}),a("el-table-column",{attrs:{label:"创建时间",align:"center",prop:"createTime",width:"180",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.parseTime(t.row.createTime,"{y}-{m}-{d} {h}:{i}:{s}")))])]}}])}),a("el-table-column",{attrs:{label:"核销时间",align:"center",prop:"redeemTime",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.parseTime(t.row.redeemTime,"{y}-{m}-{d} {h}:{i}:{s}")))])]}}])}),a("el-table-column",{attrs:{label:"操作",align:"center","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"success",disabled:"已核销"===t.row.status},on:{click:function(a){return e.handleRedeem(t.row)}}},[e._v(" 核销 ")]),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1),a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}}),a("el-dialog",{attrs:{title:"扫码核销",visible:e.scanDialogVisible,width:"80%",top:"10vh","custom-class":"scan-dialog"},on:{"update:visible":function(t){e.scanDialogVisible=t}}},[a("div",{staticClass:"scan-content"},[a("div",{staticClass:"scan-instructions"},[a("h3",[e._v("请扫描二维码进行核销")]),a("p",[e._v("将二维码对准扫描设备，系统会自动识别并完成核销操作")]),a("p",[e._v("请将系统输入法调整为英文")])]),a("div",{staticClass:"scan-input-container"},[a("el-input",{ref:"scanInput",staticClass:"scan-input",attrs:{placeholder:"请扫描或粘贴核销码"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleScanSubmit(t)},paste:function(t){return e.handlePaste(t)}},model:{value:e.scanInput,callback:function(t){e.scanInput=t},expression:"scanInput"}}),a("div",{staticClass:"scan-buttons"},[a("el-button",{staticClass:"scan-button",attrs:{type:"primary"},on:{click:e.handleScanSubmit}},[e._v("确认")]),a("el-button",{staticClass:"scan-button",on:{click:function(t){e.scanDialogVisible=!1}}},[e._v("取消")])],1)],1)])])],1)},n=[],s=a("5530"),i=a("c7eb"),o=a("1da1"),c=(a("d81d"),a("4e82"),a("b0c0"),a("d3b7"),a("498a"),a("0643"),a("a573"),a("98d0")),u=a("8e60"),l=(a("bc3a"),{name:"Code",data:function(){return{userNames:[],qrNumber:void 0,status:void 0,scanDialogVisible:!1,scanInput:"",loading:!0,ids:[],single:!0,multiple:!0,showSearch:!0,total:0,codeList:[],queryParams:{params:{startTime:null,endTime:null},orderByColumn:"createTime",isAsc:"desc",pageNum:1,pageSize:10,batchId:null,qrNumber:null,status:"未核销",userName:null,createTime:null}}},created:function(){this.loadUserNames(),this.getList()},methods:{loadUserNames:function(){var e=this;return Object(o["a"])(Object(i["a"])().mark((function t(){var a;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(u["d"])({pageNum:1,pageSize:1e3});case 3:a=t.sent,e.userNames=a.rows.map((function(e){return{value:e.name,label:e.name}})),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),console.error("加载用户列表失败:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},redeemCode:function(e){var t=this;return Object(o["a"])(Object(i["a"])().mark((function a(){var r,n;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,Object(c["f"])({qrId:e,status:"已核销",redeemTime:(new Date).toISOString()});case 3:return a.next=5,t.getList();case 5:t.$message.success("核销成功"),a.next=12;break;case 8:a.prev=8,a.t0=a["catch"](0),n=(null===a.t0||void 0===a.t0||null===(r=a.t0.response)||void 0===r||null===(r=r.data)||void 0===r?void 0:r.message)||a.t0.message||"未知错误，请联系管理员",t.$message.error("核销失败: ".concat(n));case 12:case"end":return a.stop()}}),a,null,[[0,8]])})))()},handleScanSubmit:function(){var e=this;return Object(o["a"])(Object(i["a"])().mark((function t(){var a,r,n;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.scanInput.trim()){t.next=2;break}return t.abrupt("return",e.$message.warning("请输入核销码"));case 2:return t.prev=2,t.next=5,Object(c["e"])({qrNumber:e.scanInput});case 5:if(a=t.sent,r=a.rows,null!==r&&void 0!==r&&r.length){t.next=9;break}return t.abrupt("return",e.$message.error("未找到对应二维码"));case 9:if(n=r[0],"已核销"!==n.status){t.next=12;break}return t.abrupt("return",e.$message.info("该二维码已核销"));case 12:return t.next=14,e.redeemCode(n.qrId);case 14:return t.prev=14,e.scanInput="",t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[2,,14,17]])})))()},handleRedeem:function(e){var t=this;this.$confirm("确定要核销此二维码吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(){return t.redeemCode(e.qrId)}))},handleDelete:function(e){var t=this,a=null!==e&&void 0!==e&&e.qrId?[e.qrId]:this.ids.map((function(e){return e.qrId}));this.$confirm("确认删除选中的".concat(a.length,"条数据吗？"),"警告",{type:"warning"}).then((function(){return Object(c["b"])(a)})).then((function(){t.getList(),t.$message.success("删除成功")})).catch((function(e){"cancel"!==e&&t.$message.error("删除失败: ".concat(e.message))}))},getList:function(){var e=this;this.loading=!0,Object(c["e"])(this.queryParams).then((function(t){e.codeList=t.rows.sort((function(e,t){var a=new Date(t.createTime)-new Date(e.createTime);return 0!==a?a:t.qrNumber.localeCompare(e.qrNumber,void 0,{numeric:!0})})),e.total=t.total,e.loading=!1}))},handleExport:function(){this.download("/code/code/export",Object(s["a"])({},this.queryParams),"code_".concat((new Date).getTime(),".xlsx"))},handleSelectionChange:function(e){this.ids=e.map((function(e){return{qrId:e.qrId}})),this.multiple=!e.length},handleQuery:function(){this.queryParams.pageNum=1,this.getList()},resetQuery:function(){this.resetForm("queryForm"),this.handleQuery()},openScanDialog:function(){var e=this;this.scanDialogVisible=!0,this.$nextTick((function(){return e.$refs.scanInput.focus()}))},handlePaste:function(){var e=this;setTimeout((function(){return e.handleScanSubmit()}),10)},handleSort:function(e){e.column;var t=e.prop,a=e.order;this.queryParams.orderByColumn=t,this.queryParams.isAsc="ascending"===a?"asc":"desc",this.getList()}}}),d=l,m=(a("0a30"),a("2877")),p=Object(m["a"])(d,r,n,!1,null,"50cd980e",null);t["default"]=p.exports},"4e82":function(e,t,a){"use strict";var r=a("23e7"),n=a("e330"),s=a("59ed"),i=a("7b0b"),o=a("07fa"),c=a("083a"),u=a("577e"),l=a("d039"),d=a("addb"),m=a("a640"),p=a("04d1"),f=a("d998"),h=a("2d00"),b=a("512ce"),v=[],y=n(v.sort),g=n(v.push),w=l((function(){v.sort(void 0)})),q=l((function(){v.sort(null)})),k=m("sort"),x=!l((function(){if(h)return h<70;if(!(p&&p>3)){if(f)return!0;if(b)return b<603;var e,t,a,r,n="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:a=3;break;case 68:case 71:a=4;break;default:a=2}for(r=0;r<47;r++)v.push({k:t+r,v:a})}for(v.sort((function(e,t){return t.v-e.v})),r=0;r<v.length;r++)t=v[r].k.charAt(0),n.charAt(n.length-1)!==t&&(n+=t);return"DGBEFHACIJK"!==n}})),P=w||!q||!k||!x,S=function(e){return function(t,a){return void 0===a?-1:void 0===t?1:void 0!==e?+e(t,a)||0:u(t)>u(a)?1:-1}};r({target:"Array",proto:!0,forced:P},{sort:function(e){void 0!==e&&s(e);var t=i(this);if(x)return void 0===e?y(t):y(t,e);var a,r,n=[],u=o(t);for(r=0;r<u;r++)r in t&&g(n,t[r]);d(n,S(e)),a=o(n),r=0;while(r<a)t[r]=n[r++];while(r<u)c(t,r++);return t}})},"512ce":function(e,t,a){"use strict";var r=a("342f"),n=r.match(/AppleWebKit\/(\d+)\./);e.exports=!!n&&+n[1]},"8e60":function(e,t,a){"use strict";a.d(t,"d",(function(){return n})),a.d(t,"c",(function(){return s})),a.d(t,"a",(function(){return i})),a.d(t,"e",(function(){return o})),a.d(t,"b",(function(){return c}));var r=a("b775");function n(e){return Object(r["a"])({url:"/userinfo/info/list",method:"get",params:e})}function s(e){return Object(r["a"])({url:"/userinfo/info/"+e,method:"get"})}function i(e){return Object(r["a"])({url:"/userinfo/info",method:"post",data:e})}function o(e){return Object(r["a"])({url:"/userinfo/info",method:"put",data:e})}function c(e){return Object(r["a"])({url:"/userinfo/info/"+e,method:"delete"})}},"8f7f":function(e,t,a){},"98d0":function(e,t,a){"use strict";a.d(t,"e",(function(){return n})),a.d(t,"a",(function(){return s})),a.d(t,"f",(function(){return i})),a.d(t,"b",(function(){return o})),a.d(t,"c",(function(){return c})),a.d(t,"d",(function(){return u}));var r=a("b775");function n(e){return Object(r["a"])({url:"/code/code/list",method:"get",params:e})}function s(e){return Object(r["a"])({url:"/code/code",method:"post",data:e})}function i(e){return Object(r["a"])({url:"/code/code",method:"put",data:e})}function o(e){return Object(r["a"])({url:"/code/code",method:"delete",data:{qrIds:e}})}function c(){return Object(r["a"])({url:"/code/code/stats",method:"get"})}function u(e){return Object(r["a"])({url:"/code/code/status",method:"get",params:{qrNumber:e}})}},addb:function(e,t,a){"use strict";var r=a("f36a"),n=Math.floor,s=function(e,t){var a=e.length;if(a<8){var i,o,c=1;while(c<a){o=c,i=e[c];while(o&&t(e[o-1],i)>0)e[o]=e[--o];o!==c++&&(e[o]=i)}}else{var u=n(a/2),l=s(r(e,0,u),t),d=s(r(e,u),t),m=l.length,p=d.length,f=0,h=0;while(f<m||h<p)e[f+h]=f<m&&h<p?t(l[f],d[h])<=0?l[f++]:d[h++]:f<m?l[f++]:d[h++]}return e};e.exports=s},d998:function(e,t,a){"use strict";var r=a("342f");e.exports=/MSIE|Trident/.test(r)}}]);